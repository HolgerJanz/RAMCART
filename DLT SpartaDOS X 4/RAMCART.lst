mads 1.9.9
     1 				; Ramdisk for The!Cart and SparatDOS X
     2 				; compile with MADS
     3 				; written by Eric Bacher and Holger Janz
     4 				; based on a ramdisk skeleton provided by Trub
     5 				;
     6
     7 				; OS equ
     8
     9
    10 = 0006			TRAMSZ   EQU $06
    11 = 0008			WARMST   EQU $08
    12 = 0009			BOOT_    EQU $09
    13 = 000C			DOSINI   EQU $0C
    14 = 000E			APPMHI   EQU $0E
    15 = 0010			IRQENS   EQU $10
    16 = 0011			IRQSTAT  EQU $11
    17 = 0012			RTCLOK   EQU $12
    18
    19 = 0020			ichidz   EQU $20
    20 = 0021			ICDNOZ   EQU $21
    21 = 0022			ICCOMZ   EQU $22
    22 = 0023			ICSTZ    EQU $23
    23 = 0024			ICBAZ    EQU $24
    24 = 0026			ICPTZ    EQU $26
    25 = 0028			ICBLZ    EQU $28
    26 = 002A			ICAX1Z   EQU $2A
    27 = 002B			ICAX2Z   EQU $2B
    28 = 002C			ICAX3Z   EQU $2C
    29 = 002E			ICAX5Z   EQU $2E
    30 = 002F			ICAX6Z   EQU $2F
    31 = 0030			SIOSTAT  EQU $30
    32 = 0031			CHKSUM   EQU $31
    33 = 0032			BUFR     EQU $32
    34 = 0034			BUFEN    EQU $34
    35 = 0041			IOSNDEN  EQU $41
    36 = 0042			CRITIC   EQU $42
    37 = 0043			ZBUFA    EQU $43
    38 = 0045			ZDRVA    EQU $45
    39 = 0047			INIFLG   EQU $47
    40 = 004D			ATRACT   EQU $4D
    41 = 0052			LMARGN   EQU $52
    42 = 0053			RMARGN   EQU $53
    43 = 0054			VCP      EQU $54
    44 = 0055			HCP      EQU $55
    45 = 0058			SAVMSC   EQU $58
    46
    47 = 0063			LOGCOL   EQU $63
    48 = 006A			RAMTOP   EQU $6A
    49
    50 = 0218			TIMCNT1  equ $218
    51 = 0222			VVBLKI   EQU $222
    52 = 0226			TIMVEC1  EQU $226
    53 = 022F			DMACTLS  EQU $22F
    54 = 0230			DLPTRS   EQU $230
    55 = 023A			CDEVIC   EQU $23A
    56 = 023B			CCMND    EQU $23B
    57 = 023C			CAUX1    EQU $23C
    58 = 023D			CAUX2    EQU $23D
    59 = 0244			COLDST   EQU $244
    60 = 0247			PDVMSK   EQU $247
    61 = 0248			PDVRS    EQU $248
    62 = 029C			CRETRY   EQU $29C
    63 = 02B6			INVFLG   EQU $2B6
    64 = 02BD			DRETRY   EQU $2BD
    65 = 02BE			SHFLOK   EQU $2BE
    66 = 02C5			COLPF1S  EQU $2C5
    67 = 02C6			COLPF2S  EQU $2C6
    68 = 02C7			COLPF3S  EQU $2C7
    69 = 02C8			COLBAKS  EQU $2C8
    70 = 02D9			KRPDEL   EQU $2D9
    71 = 02DA			KEYREP   EQU $2DA
    72 = 02DB			NOCLIK   EQU $2DB
    73 = 02DC			hlpflg   equ $02dc
    74 = 02E0			RUNAD    EQU $2E0
    75 = 02E2			INITAD   EQU $2E2
    76 = 02E5			MEMTOP   EQU $2E5
    77 = 02E7			MEMLO    EQU $2E7
    78 = 02EA			dvstat   EQU $2ea
    79 = 02F0			CRSINH   EQU $2F0
    80 = 02F2			oldkbc   equ $02f2
    81 = 02F4			CHBAS    EQU $2F4
    82 = 02FB			ATACHR   EQU $2FB
    83 = 02FC			KBCODES  EQU $2FC
    84 = 02FE			DSPFLG   EQU $2FE
    85 = 02FF			SSFLAG   EQU $2FF
    86
    87 = 0300			DCB      EQU $300
    88 = 0300			DDEVIC   EQU $300
    89 = 0301			DUNIT    EQU $301
    90 = 0302			DCMND    EQU $302
    91 = 0303			DSTATS   EQU $303
    92 = 0304			DBUFA    EQU $304
    93 = 0304			DBUFAL   EQU $304
    94 = 0305			DBUFAH   EQU $305
    95 = 0306			DTIMLO   EQU $306
    96 = 0308			DBYT     EQU $308
    97 = 0308			DBYTL    EQU $308
    98 = 0309			DBYTH    EQU $309
    99 = 030A			DAUX     EQU $30A
   100 = 030A			DAUX1    EQU $30A
   101 = 030B			DAUX2    EQU $30B
   102 = 030F			CASFLG   EQU $30F
   103 = 0318			STACKP   EQU $318
   104 = 0319			TSTAT    EQU $319
   105 = 031A			HATABS   EQU $31A
   106 = 0341			ICDNO    EQU $341
   107 = 0342			ICCMD    EQU $342
   108 = 0344			ICBUFA   EQU $344
   109 = 0346			ICPUTB   EQU $346
   110 = 0348			ICBUFL   EQU $348
   111 = 034A			ICAX1    EQU $34A
   112 = 034B			ICAX2    EQU $34B
   113 = 034C			ICAX3    EQU $34C
   114 = 034D			ICAX4    EQU $34D
   115 = 034E			ICAX5    EQU $34E
   116 = 034F			ICAX6    EQU $34F
   117 = 03EB			CARTCK   EQU $3EB
   118 = 03F8			BASICF   EQU $3F8
   119 = 03FA			GINTLK   EQU $3FA
   120
   121 = 0580			BUF580   EQU $580
   122
   123
   124 = BFF0			CART     EQU $BFF0
   125 = BFFA			CARTRUN  EQU $BFFA
   126
   127 = CFFF			ABANK    EQU $CFFF
   128
   129 = D013			TRIG3    EQU $D013
   130 = D014			PAL      EQU $D014
   131 = D01F			CONSOL   EQU $D01F
   132 = D000			GTIA     EQU $D000
   133 = D1FF			PDVREG   EQU $D1FF
   134 = D201			AUDC1    EQU $D201
   135 = D203			AUDC2    EQU $D203
   136 = D204			AUDF3    EQU $D204
   137 = D205			AUDC3    EQU $D205
   138 = D206			AUDF4    EQU $D206
   139 = D207			AUDC4    EQU $D207
   140 = D208			AUDCTL   EQU $D208
   141 = D209			KBCODE   EQU $D209
   142 = D20A			RANDOM   EQU $D20A
   143 = D20A			SKSTRES  EQU $D20A
   144 = D20D			SEROUT   EQU $D20D
   145 = D20D			SERIN    EQU $D20D
   146 = D20E			IRQST    EQU $D20E
   147 = D20E			IRQEN    EQU $D20E
   148 = D20F			SKCTL    EQU $D20F
   149 = D20F			SKSTAT   EQU $D20F
   150 = D300			PORTA    EQU $D300
   151 = D301			PORTB    EQU $D301
   152 = D302			PACTL    EQU $D302
   153 = D303			PBCTL    EQU $D303
   154 = D400			DMACTL   EQU $D400
   155 = D402			DLPTR    EQU $D402
   156 = D40A			WSYNC    EQU $D40A
   157 = D40B			VCOUNT   EQU $D40B
   158 = D40E			NMIEN    EQU $D40E
   159 = D40F			NMIST    EQU $D40F
   160
   161 = D500			CART_ON  EQU $D500
   162 = D508			CART_OF  EQU $D508
   163
   164 = D805			PDIOR    EQU $D805
   165
   166 = E000			CHARSET1 EQU $E000
   167 = E400			DEVHAT   EQU $E400
   168 = E420			KBDVEC   EQU $E420
   169 = E424			VKBGBYT  EQU $E424
   170 = E456			JCIOMAIN EQU $E456
   171 = E459			JSIOINT  EQU $E459
   172 = E45C			SETVBLV  EQU $E45C
   173 = E477			JRESETCD EQU $E477
   174 = E46B			JNMIENBL EQU $E46B
   175
   176 = E459			SIOV     EQU $E459
   177 = E45F			JSYSVBL  EQU $E45F
   178 = E462			JEXITVBL EQU $E462
   179 = E486			JNEWDEVC EQU $E486
   180
   181 = FFFA			NMIVEC   EQU $FFFA
   182 = FFFC			RESETVEC EQU $FFFC
   183 = FFFE			IRQVEC   EQU $FFFE
   184
   185 				; SDX equ
   186
   187 = 0015			bufadr   equ $15
   188 = 0018			dskfms   equ $18
   189 = 001A			dskutl   equ $1A
   190
   191 = 0700			S_FLAG   EQU $700
   192 = 0701			SDXVER   EQU $701
   193 = 0702			SDXREV   EQU $702
   194 = 0703			JKERNEL  EQU $703
   195 = 0706			BLOCK_IO EQU $706
   196 = 0709			JMISC    EQU $709
   197 = 070C			JLSIO    EQU $70C
   198 				;SIOIDX   EQU $70F  ;Sector IO InDeX.
   199 = 0715			JHWCTRL  EQU $715
   200 = 0718			SIOHAND  EQU $718
   201 = 0720			SLVTAB   EQU $720
   202 = 0730			LDFTAB   EQU $730
   203 = 0740			DEVTAB   EQU $740
   204 = 0750			HANDTAB  EQU $750
   205 = 0760			fhandle equ $0760
   206 = 0760			SIOCBIDX EQU $760
   207 = 0761			DEVICE   EQU $761
   208 = 0762			NAME     EQU $762
   209 = 076D			NAMES    EQU $76D
   210 = 0778			fmode   equ $778
   211 = 0778			OPMODE   EQU $778
   212 = 0779			FATR1    EQU $779
   213 = 077A			FATR2    EQU $77A
   214 = 077B			DATE     EQU $77B
   215 = 077E			TIME     EQU $77E
   216 = 0781			DATESET  EQU $781
   217 = 0782			FAUX1    EQU $782
   218 = 0783			FAUX2    EQU $783
   219 = 0784			FAUX3    EQU $784
   220 = 0785			FAUX4    EQU $785
   221 = 0786			FAUX5    EQU $786
   222 = 0787			SYSCALL  EQU $787
   223 = 0789			DIRBUF   EQU $789
   224 = 0789			DIRFATR  EQU $789
   225 = 078A			DIRF1SEC EQU $78A
   226 = 078C			DIRFLEN  EQU $78C
   227 = 078F			DIRFNAME EQU $78F
   228 = 079A			DIRFDATE EQU $79A
   229 = 079D			DIRFTIME EQU $79D
   230 = 07A0			PATH     EQU $7A0
   231 = 07E0			DOSVECT  EQU $7E0
   232 = 07E0			JHDOSINI EQU $7E0
   233 = 07E3			VDOS     EQU $7E3
   234 = 07E5			VCIO     EQU $7E5
   235 = 07E7			VEDIT    EQU $7E7
   236 = 07E9			VCRUNCH  EQU $7E9   
   237 				;JTEMP    EQU $7EB
   238 = 07EB			JFSYMBOL EQU $7EB
   239 = 07EE			JMDVECT  EQU $7EE
   240 = 07F1			JEXT_ON  EQU $7F1
   241 = 07F4			JEXT_OFF EQU $7F4
   242 = 07F7			JEXT_SW  EQU $7F7
   243 = 07FA			JCAR_SW  EQU $7FA
   244 = 07FD			JCAR_OLD EQU $7FD
   245
   246 				;******************
   247 = 2000			BANKSIZE EQU 8192
   248
   249 				        
   250 				;******************
   251 				;* Vectors under ROM
   252
   253 = FFC0			highvect equ $FFC0
   254 = FFC0			jgettd   equ $ffc0
   255 = FFC3			jsettd   equ $ffc3
   256 = FFC6			jtdon    equ $ffc6
   257 = FFC9			jfmttd   equ $ffc9
   258 = FFD2			jxcomli  equ $ffd2
   259 = FFD5			jkeyon   equ $ffd5
   260
   261 				;******************
   262 = 00B3			_err_memory_conflict    equ $b3
   263 = 00B5			_err_disk_corrupt       equ $b5
   264
   265
   266 				; SDX Symbols
   267
   268 = 0000			_CIO     SMB '_CIO'
   269 = 0000			_CRUNCH  SMB '_CRUNCH'
   270 = 0000			_DOS     SMB '_DOS'
   271 = 0000			_EDIT    SMB '_EDIT'
   272 = 0000			_INITZ   SMB '_INITZ'
   273 = 0000			__MISC   smb '__MISC'
   274 = 0000			BUILDDIR SMB 'BUILDDIR'
   275 = 0000			CARVARS  SMB 'CARVARS'  ;as of SDX 4.30
   276 = 0000			CHDIR    SMB 'CHDIR'
   277 = 0000			CHMOD    SMB 'CHMOD'
   278 = 0000			CKSPEC   SMB 'CKSPEC'
   279 = 0000			COMTAB   SMB 'COMTAB'
   280 = 0000			COMTAB2  SMB 'COMTAB2'  ;as of SDX 4.30
   281 = 0000			CURDEV   SMB 'CURDEV'
   282 = 0000			DEVSPEC  SMB 'DEVSPEC'  ;as of SDX 4.30
   283 = 0000			DEVNAME  SMB 'DEVNAME'  ;as of SDX 4.30
   284 = 0000			DIV_32   SMB 'DIV_32'
   285 = 0000			DIVIO    SMB 'DIVIO'
   286 = 0000			ENV_P    SMB 'ENV_P'
   287 = 0000			ERRNO    smb 'ERRNO'
   288 = 0000			EXTENDED SMB 'EXTENDED'
   289 = 0000			FCLEVEL  SMB 'FCLEVEL'
   290 = 0000			FCLOSE   SMB 'FCLOSE'
   291 = 0000			FCLOSEAL SMB 'FCLOSEAL'
   292 = 0000			FDCLOSE  SMB 'FDCLOSE'
   293 = 0000			FDGETC   SMB 'FDGETC'
   294 = 0000			FDOPEN   SMB 'FDOPEN'
   295 = 0000			FFIRST   SMB 'FFIRST'
   296 = 0000			FGETC    SMB 'FGETC'
   297 = 0000			FGETS    SMB 'FGETS'
   298 = 0000			FILE_P   SMB 'FILE_P'
   299 = 0000			FILELENG SMB 'FILELENG'
   300 = 0000			FLAG     SMB 'FLAG'
   301 = 0000			FNEXT    SMB 'FNEXT'
   302 = 0000			FOPEN    SMB 'FOPEN'
   303 = 0000			FORMAT   SMB 'FORMAT'
   304 = 0000			FPRINTF  SMB 'FPRINTF'
   305 = 0000			FPUTC    SMB 'FPUTC'
   306 = 0000			FPUTS    SMB 'FPUTS'
   307 = 0000			FREAD    SMB 'FREAD'
   308 = 0000			FSEEK    SMB 'FSEEK'
   309 = 0000			FTELL    SMB 'FTELL'
   310 = 0000			FWRITE   SMB 'FWRITE'
   311 = 0000			GETC     SMB 'GETC'
   312 = 0000			GETCWD   SMB 'GETCWD'
   313 = 0000			GETDFREE SMB 'GETDFREE'
   314 = 0000			GETENV   SMB 'GETENV'
   315 = 0000			GETS     SMB 'GETS'
   316 = 0000			H_FENCE  SMB 'H_FENCE'
   317 = 0000			I_GETTD  SMB 'I_GETTD'
   318 = 0000			I_SETTD  SMB 'I_SETTD'
   319 = 0000			INSTALL  SMB 'INSTALL'
   320 = 0000			MALLOC   SMB 'MALLOC'
   321 = 0000			MKDIR    SMB 'MKDIR'
   322 = 0000			MUL_32   SMB 'MUL_32'
   323 = 0000			NUMENV   SMB 'NUMENV'
   324 = 0000			PRINTF   SMB 'PRINTF'
   325 = 0000			PRO_NAME SMB 'PRO_NAME'
   326 = 0000			PUT_V    SMB 'PUT_V'
   327 = 0000			PUTC     SMB 'PUTC'
   328 = 0000			PUTENV   SMB 'PUTENV'
   329 = 0000			PUTS     SMB 'PUTS'
   330 = 0000			REMOVE   SMB 'REMOVE'
   331 = 0000			RENAME   SMB 'RENAME'
   332 = 0000			RENDIR   smb 'RENDIR'
   333 = 0000			RMDIR    SMB 'RMDIR'
   334 = 0000			S_ADD    SMB 'S_ADD'
   335 = 0000			S_ADDIZ  SMB 'S_ADDIZ'
   336 = 0000			S_CLEAR  SMB 'S_CLEAR'
   337 = 0000			S_LOOKUP SMB 'S_LOOKUP'
   338 = 0000			S_NEXT   SMB 'S_NEXT'
   339 = 0000			SETBOOT  SMB 'SETBOOT'
   340 = 0000			STATUS   SMB 'STATUS'
   341 = 0000			SYMBOL   SMB 'SYMBOL'
   342 = 0000			SYSLEVEL SMB 'SYSLEVEL'
   343 = 0000			T_       SMB 'T_'
   344 = 0000			TOUPPER  SMB 'TOUPPER'
   345 = 0000			U_ERROR  SMB 'U_ERROR'
   346 = 0000			U_EXPAND SMB 'U_EXPAND'
   347 = 0000			U_FAIL   SMB 'U_FAIL'
   348 = 0000			U_FSPEC  SMB 'U_FSPEC'
   349 = 0000			U_GEFINA SMB 'U_GEFINA'
   350 = 0000			U_GEPATH SMB 'U_GEPATH'
   351 = 0000			U_GETATR SMB 'U_GETATR'
   352 = 0000			U_GETFLG SMB 'U_GETFLG'
   353 = 0000			U_GETKEY SMB 'U_GETKEY' ;as of SDX 4.30
   354 = 0000			U_GETNUM SMB 'U_GETNUM'
   355 = 0000			U_GETPAR SMB 'U_GETPAR'
   356 = 0000			U_GONOFF SMB 'U_GONOFF'
   357 = 0000			U_LOAD   SMB 'U_LOAD'
   358 = 0000			U_PARAM  SMB 'U_PARAM'
   359 = 0000			U_SFAIL  SMB 'U_SFAIL'
   360 = 0000			U_SLASH  SMB 'U_SLASH'
   361 = 0000			U_TOKEN  SMB 'U_TOKEN'
   362 = 0000			U_UNLOAD SMB 'U_UNLOAD'
   363 = 0000			U_XFAIL  SMB 'U_XFAIL'
   364 = 0000			VALIDATE SMB 'VALIDATE'
   365 = 0000			VPRINTF  SMB 'VPRINTF'
   366 = 0000			XDIVIO   SMB 'XDIVIO'
   367 = 0000			_XHDIR   SMB '_XHDIR'
   368 = 0000			_XPROC   SMB '_XPROC'
   369
   370
   371 				; 
   372 				; The!Cart Register (from-to,default)
   373 				;
   374
   375 				; Mode Select
   376 = D5A6			TCMOSL = $d5a6    ; mode ($00-$3d,$01)
   377 				; Cartridge mode is selected with bits 0-5 of $D5A6, values
   378 				; other than the ones listed here are reserved (and result
   379 				; in "cartridge off"):
   380 				; $00: off, cartridge disabled
   381 				; $01: 8k banks at $A000
   382 				; $02: AtariMax 1MBit / 128k
   383 				; $03: Atarimax 8MBit / 1MB
   384 				; $04: OSS M091
   385 				; $08: SDX 64k cart, $D5Ex banking
   386 				; $09: Diamond GOS 64k cart, $D5Dx banking
   387 				; $0A: Express 64k cart, $D57x banking
   388 				; $0C: Atrax 128k cart
   389 				; $0D: Williams 64k cart
   390 				; $20: flexi mode (separate 8k banks at $A000 and $8000)
   391 				; $21: standard 16k cart at $8000-$BFFF
   392 				; $22: MegaMax 16k mode (up to 2MB), AtariMax 8Mbit banking
   393 				; $23: Blizzard 16k
   394 				; $24: Sic!Cart 512k
   395 				; $28: 16k Mega cart
   396 				; $29: 32k Mega cart
   397 				; $2A: 64k Mega cart
   398 				; $2B: 128k Mega cart
   399 				; $2C: 256k Mega cart
   400 				; $2D: 512k Mega cart
   401 				; $2E: 1024k Mega cart
   402 				; $2F: 2048k Mega cart
   403 				; $30: 32k XEGS cart
   404 				; $31: 64k XEGS cart
   405 				; $32: 128k XEGS cart
   406 				; $33: 256k XEGS cart
   407 				; $34: 512k XEGS cart
   408 				; $35: 1024k XEGS cart
   409 				; $38: 32k SWXEGS cart
   410 				; $39: 64k SWXEGS cart
   411 				; $3A: 128k SWXEGS cart
   412 				; $3B: 256k SWXEGS cart
   413 				; $3C: 512k SWXEGS cart
   414 				; $3D: 1024k SWXEGS cart
   415 = 0000			TCMOSL.OFF   = $00    ; off, cartridge disabled
   416 = 0001			TCMOSL.8K    = $01    ; 8k banks at $A000
   417 = 0003			TCMOSL.AM1MB = $03
   418 = 0020			TCMOSL.FLEXI = $20    ; flexi mode, separate 8k banks at $A000 and $8000
   419 = 0021			TCMOSL.16K   = $21    ; standard 16k cart at $8000-$BFFF
   420
   421 				; how to figure out that The!Cart is not active?
   422 				; If the address is not used then the XL returns $ff but
   423 				; the XE (and old 800) return $d5 (high byte of address,
   424 				; the value of the last bus cycle)
   425 = 00FF			TCMOSL.XLLOCK  = $ff    ; config lock or not present
   426 = 00D5			TCMOSL.XELOCK  = $d5    ; config lock or not present
   427
   428 				; Mode Flash/RAM Select
   429 = D5A7			TCMOFR = $d5a7    ;flash/RAM mode (0-15,0)
   430 				; bit 0: primary bank write enable (0=readOnly, 1=write)
   431 				; bit 1: primary bank source (0=flash, 1=RAM)
   432 				; bit 2: secondary bank write enable (0=readOnly, 1=write)
   433 				; bit 3: secondary bank source (0=flash, 1=RAM)
   434 = 0003			TCMOFR.PBRAM = $03    ; primary bank RAM
   435 = 000C			TCMOFR.SBRAM = $0C    ; secondary bank RAM
   436
   437 				; Primary Bank
   438 = D5A0			TCPBRL = $d5a0    ; register low byte (0-255,0)
   439 = D5A1			TCPBRH = $d5a1    ; register high byte (0-63,0)
   440 = D5A2			TCPBEN = $d5a2    ; enable (0=dis-1=en,1)
   441
   442 				; Secondary Bank 
   443 = D5A3			TCSBRL = $d5a3    ; register low byte (0-255,0)
   444 = D5A4			TCSBRH = $d5a4  ; register high byte (0-63,0)
   445 = D5A5			TCSBEN = $d5a5    ; enable (0=dis-1=en,0)
   446
   447 				; SPI interface to EEPROM
   448 = D5A8			TCINEP = $d5a8
   449 				; bit 0: SPI CLK
   450 				; bit 1: SPI CS
   451 				; bit 7: SPI data in (on reads), SPI data out (on writes)
   452
   453 				; configuration lock
   454 = D5AF			TCCOLO = $d5af
   455 				; Writing to this register disables "The!Cart" registers
   456 				; at $d5aX.
   457
   458
   459 				;
   460 				; Offset from COMTAB
   461 				;
   462 = 001A			TRAILS   = $1A
   463 = 0021			CONFNAM  = $21
   464 				;
   465 				; Ramdisk size in KB if not specified on command line
   466 				;
   467 = 0200			RAMDISK_SIZE = 512
   468 				;
   469 				; ******************************************************************************
   470 				;
   471 				;    
   472  FA FF			     blk sparta $3000
   473 				;
   474 				; check if we are running on THE!CART hardware
   475 				;
   476 3000-325B> AD A6 D5	     lda TCMOSL
   477 3003 C9 FF		     cmp #TCMOSL.XLLOCK
   478 3005 F0 04		     beq ?skipped
   479 3007 C9 D5		     cmp #TCMOSL.XELOCK
   480 3009 D0 03		     bne ?thecart_hardware
   481 300B			?skipped
   482 300B 4C EB 31		     jmp nocartram
   483 				;
   484 				; find the maximum drive number and store it in ramdisk_drive
   485 				;
   486 300E			?thecart_hardware
   487 300E AD FE FF		     lda DEVSPEC-2
   488 3011 8D 91 01		     sta ramdisk_drive
   489 3014 A9 B1		     lda #<maxvar
   490 3016 A2 31		     ldx #>maxvar
   491 3018 20 00 00		     jsr GETENV
   492 301B 30 10		     bmi ?nomxd
   493 301D AD 80 05		     lda BUF580
   494 3020 38			     sec
   495 3021 E9 40		     sbc #$40
   496 3023 30 08		     bmi ?nomxd
   497 3025 CD 91 01		     cmp ramdisk_drive
   498 3028 B0 03		     bcs ?nomxd
   499 302A 8D 91 01		     sta ramdisk_drive
   500 302D			?nomxd
   501 				;
   502 				; check if a drive number has been provided in the command
   503 				;
   504 302D 20 00 00		     jsr U_GETPAR
   505 3030 F0 43		     beq ?no_parameters
   506 3032 A2 00		     ldx #$00
   507 3034			?ppar1
   508 3034 BD 21 00		     lda COMTAB+CONFNAM,x
   509 3037 C9 30		     cmp #'0'
   510 3039 90 24		     bcc ?epar1
   511 303B C9 3A		     cmp #'9'+1
   512 303D B0 20		     bcs ?epar1
   513 303F 48			     pha
   514 3040 AD A7 31		     lda newdrvn
   515 3043 0A			     asl
   516 3044 8D 9B 31		     sta multmp
   517 3047 0A			     asl
   518 3048 0A			     asl
   519 3049 18			     clc
   520 304A 6D 9B 31		     adc multmp
   521 304D 8D A7 31		     sta newdrvn
   522 3050 68			     pla
   523 3051 29 0F		     and #$0F
   524 3053 6D A7 31		     adc newdrvn
   525 3056 8D A7 31		     sta newdrvn
   526 3059 E8			     inx
   527 305A EC 1A 00		     cpx COMTAB+TRAILS
   528 305D 90 D5		     bcc ?ppar1
   529 305F			?epar1
   530 305F AD A7 31		     lda newdrvn
   531 3062 D0 05		     bne ?num
   532 3064 AD 21 00		     lda COMTAB+CONFNAM
   533 3067 29 1F		     and #$1f
   534 3069			?num
   535 3069 C9 10		     cmp #16
   536 306B B0 08		     bcs ?no_parameters
   537 306D CD 91 01		     cmp ramdisk_drive
   538 3070 B0 03		     bcs ?no_parameters
   539 3072 8D 91 01		     sta ramdisk_drive
   540 				;
   541 				; use max size 
   542 				;
   543 3075			?no_parameters
   544 3075 A9 00		     lda #<RAMDISK_SIZE
   545 3077 8D A1 01		     sta ramdisk_sectors
   546 307A A2 02		     ldx #>RAMDISK_SIZE
   547 307C 8E A2 01		     stx ramdisk_sectors+1
   548 				;
   549 				; convert ramdisk size (in Kb) into number of sectors (sector len = 128 bytes)
   550 				;
   551 307F AD A1 01		     lda ramdisk_sectors
   552 3082 0A			     asl
   553 3083 2E A2 01		     rol ramdisk_sectors+1
   554 3086 0A			     asl
   555 3087 2E A2 01		     rol ramdisk_sectors+1
   556 308A 0A			     asl
   557 308B 2E A2 01		     rol ramdisk_sectors+1
   558 308E 8D A1 01		     sta ramdisk_sectors
   559 				;
   560 				; find a free entry in the SIO table
   561 				;
   562 3091 A2 06		     ldx #$06
   563 3093			?next_sio_entry
   564 3093 BD 19 07		     lda SIOHAND+1,x
   565 3096 F0 07		     beq ?free_sio_entry
   566 3098 CA			     dex
   567 3099 CA			     dex
   568 309A 10 F7		     bpl ?next_sio_entry
   569 309C 4C B8 31		     jmp sio_full
   570 				;
   571 				; save SIO handler
   572 				;
   573 309F			?free_sio_entry
   574 309F AD 9C 31		     lda prdsio
   575 30A2 9D 18 07		     sta SIOHAND,x
   576 30A5 AD 9D 31		     lda prdsio+1
   577 30A8 9D 19 07		     sta SIOHAND+1,x
   578 				;
   579 				; set ramdisk name
   580 				;
   581 30AB AD 91 01		     lda ramdisk_drive
   582 30AE 09 30		     ora #$30
   583 30B0 8D AF 31		     sta rddrvch
   584 30B3 8D 93 31		     sta report_drive
   585 30B6 8D 5D 31		     sta preserved_drive
   586 				;
   587 				; set max sector number
   588 				;
   589 30B9 AD A2 01		     lda ramdisk_sectors+1
   590 30BC 8D 94 01		     sta spt_hi
   591 30BF AD A1 01		     lda ramdisk_sectors
   592 30C2 8D 95 01		     sta spt_lo
   593 				;
   594 				; check if there is a ramdisk content to preserve
   595 				; by looking at the magic bytes at the start of RAM
   596 				; Disable interrupts before switching to RAM because of
   597 				; cartridge lock and preserve THE!CART registers
   598 				;
   599
   600 30C5 AD A2 D5		     lda TCPBEN         ; save register
   601 30C8 48			     pha
   602 30C9 AD A7 D5		     lda TCMOFR
   603 30CC 48			     pha
   604 30CD AD A0 D5		     lda TCPBRL
   605 30D0 48			     pha
   606 30D1 AD A1 D5		     lda TCPBRH
   607 30D4 48			     pha
   608 30D5 AD A6 D5		     lda TCMOSL
   609 30D8 48			     pha
   610
   611 30D9 A9 FF		     lda #$FF           ; start critical
   612 30DB 85 42		     sta CRITIC 
   613 30DD A5 14		     lda RTCLOK+2
   614 30DF			_wait1
   615 30DF C5 14		     cmp RTCLOK+2
   616 30E1 F0 FC		     beq _wait1
   617
   618 30E3 78			     sei                ; disable all interrupts
   619 30E4 A9 00		     lda #$00
   620 30E6 8D 0E D4		     sta NMIEN
   621
   622 30E9 A9 21		     lda #TCMOSL.16K    ; set 16k mode at $8000-$BFFF
   623 30EB 8D A6 D5		     sta TCMOSL
   624 30EE A9 03		     lda #TCMOFR.PBRAM  ; set to RAM
   625 30F0 8D A7 D5		     sta TCMOFR
   626 30F3 A9 00		     lda #$00
   627 30F5 8D A0 D5		     sta TCPBRL         ; get bank number from X
   628 30F8 8D A1 D5		     sta TCPBRH         ; set high to $00
   629 30FB A9 01		     lda #$01
   630 30FD 8D A2 D5		     sta TCPBEN         ; enable
   631
   632 3100 A9 00		     lda #0
   633 3102 8D A6 31		     sta no_magic       ; used to store if magic is found (0=yes)
   634
   635 3105 A2 07		     ldx #7
   636 3107			next_magic
   637 3107 BD 9E 31		     lda magic,x
   638 310A DD 00 80		     cmp $8000,x
   639 310D F0 06		     beq good_magic
   640 310F 9D 00 80		     sta $8000,x
   641 3112 CE A6 31		     dec no_magic
   642 3115			good_magic
   643 3115 CA			     dex
   644 3116 10 EF		     bpl next_magic
   645
   646 3118 68			     pla                ; restore register
   647 3119 8D A6 D5		     sta TCMOSL
   648 311C 68			     pla
   649 311D 8D A1 D5		     sta TCPBRH
   650 3120 68			     pla
   651 3121 8D A0 D5		     sta TCPBRL
   652 3124 68			     pla
   653 3125 8D A7 D5		     sta TCMOFR
   654 3128 68			     pla
   655 3129 8D A2 D5		     sta TCPBEN
   656
   657 312C A9 E0		     lda #$E0           ; enable interrupts
   658 312E 8D 0E D4		     sta NMIEN
   659 3131 58			     cli
   660
   661 3132 A9 00		     lda #$00           ; reset crirical
   662 3134 85 42		     sta CRITIC 
   663 				;
   664 				; check if ramdisk is already initialized
   665 				;
   666 3136 AD A6 31		     lda no_magic
   667 3139 30 29		     bmi ?erase_content
   668 				;
   669 				; ramdisk has a previous content
   670 				;
   671 313B 20 00 00		     jsr PRINTF
   672 313E 52 61 6D 63 61 72 +      .byte 'Ramcart ver47 preserved drive D'
   673 315D			preserved_drive
   674 315D 3F 3A 9B 00		     .byte '?:',$9B,0
   675 3161 4C 97 31		     jmp ?end
   676 				;
   677 				; ramdisk must be initialised because no previous content has been found
   678 				; Build SpartaDos disk structure
   679 				;
   680 3164			?erase_content
   681 3164 A9 31		     lda #$31
   682 3166 8D 00 03		     sta DDEVIC
   683 3169 AD 91 01		     lda ramdisk_drive
   684 316C 8D 01 03		     sta DUNIT
   685 316F A9 A8		     lda #<rdname
   686 3171 A2 31		     ldx #>rdname
   687 3173 20 00 00		     jsr BUILDDIR
   688 				;
   689 				; ramdisk is initialized
   690 				;
   691 3176 20 00 00		     jsr PRINTF
   692 3179 52 61 6D 63 61 72 +      .byte 'Ramcart ver47 init drive D'
   693 3193			report_drive
   694 3193 3F 3A 9B 00		     .byte '?:',$9B,0
   695 				;
   696 				; mark the device as being installed
   697 				;
   698 3197			?end
   699 3197 CE 00 00		     dec INSTALL
   700 319A 60			     rts
   701 				;
   702 				; Strings and variables
   703 				;
   704 319B			multmp
   705 319B 00			     .byte 0
   706 319C			prdsio
   707 319C 00 00		     .word rdsio
   708 319E			magic
   709 319E 34 23 32 21 2D 28 +      .byte "TCRAMHJX"
   710 31A6			no_magic
   711 31A6 00			     .byte 0
   712 31A7			newdrvn
   713 31A7 00			     .byte 0
   714 31A8			rdname
   715 31A8 52 41 4D 43 41 52 +      .byte 'RAMCART'
   716 31AF			rddrvch
   717 31AF 31 9B		     .byte '1',$9B
   718 31B1			maxvar
   719 31B1 4D 41 58 44 52 56 +      .byte 'MAXDRV',$9B
   720 				;
   721 				; Display an error when SIO table is full
   722 				;
   723 31B8			sio_full
   724 31B8 20 00 00		     jsr PRINTF
   725 31BB 52 61 6D 63 61 72 +      .byte 'Ramcart ver47 not installed:',$9b
   726 31D8 20 20 53 49 4F 20 +      .byte '  SIO table full',$9B,0
   727 31EA 60			     rts
   728 				;
   729 				; Cartridge ram not found
   730 				;
   731 31EB			nocartram:
   732 31EB 20 00 00		     jsr PRINTF
   733 31EE 52 61 6D 63 61 72 +      .byte 'Ramcart ver47 The!Cart is locked:',$9B
   734 3210 20 20 20 55 73 65 +      .byte '   Use SHIFT-RETURN or SHIFT-Fire in',$9B
   735 3235 20 20 20 54 68 65 +      .byte '   The!Cart main menu to unlock RAM.',$9B,0
   736 325B 60			     rts
   737
   738 				;
   739 				; ******************************************************************************
   740 				;
   741 325C FE FF 01 00		     blk reloc main  
   742 				;
   743 				; An I/O is requested
   744 				;
   745 0000			rdsio
   746 0000,0228> 08		     php
   747 0001 20 0E 00		     jsr sio_handler
   748 0004 98			     tya
   749 0005 28			     plp
   750 0006 C9 FF		     cmp #$FF
   751 0008 F0 02		     beq set_carry
   752 000A 18			     clc
   753 000B 60			     rts
   754 000C			set_carry
   755 000C 38			     sec
   756 000D 60			     rts
   757 				;
   758 				; Ramdisk SIO handler
   759 				;
   760 000E			sio_handler
   761 000E AD 00 03		     lda DDEVIC
   762 0011 29 F0		     and #$f0
   763 0013 C9 30		     cmp #$30
   764 0015 D0 30		     bne ?nordsio
   765 0017 AD 01 03		     lda DUNIT
   766 001A C9 10		     cmp #$10
   767 001C B0 04		     bcs ?isrddrv
   768 				;
   769 				; get drive number from new swap table
   770 				;
   771 001E AA			     tax
   772 001F BD 01 00		     lda COMTAB2+2-1,x
   773 0022			?isrddrv
   774 0022 CD 91 01		     cmp ramdisk_drive
   775 0025 D0 20		     bne ?nordsio
   776 0027 A2 01		     ldx #$01
   777 0029			?sbb
   778 0029 BD 04 03		     lda DBUFAL,x
   779 002C 95 34		     sta BUFEN,x
   780 002E 9D 65 01		     sta _rtofast+1,x
   781 0031 9D 29 01		     sta _wfromfast+1,x
   782 0034 CA			     dex
   783 0035 10 F2		     bpl ?sbb
   784 0037 AD 02 03		     lda DCMND
   785 003A A2 04		     ldx #$04
   786 003C			?nextcmd
   787 003C DD A3 01		     cmp sio_cmds,x
   788 003F F0 13		     beq ?callcmd
   789 0041 CA			     dex
   790 0042 10 F8		     bpl ?nextcmd
   791 0044			?rwerr
   792 0044 A0 8B		     ldy #139 ;NAK
   793 0046 60			     rts
   794 0047			?nordsio
   795 0047 A0 FF		     ldy #$FF
   796 0049 60			     rts
   797
   798 				;
   799 				; other commands (status, percom)
   800 				;
   801 004A			?jother
   802 004A E0 04		     cpx #$04
   803 004C F0 03		     beq ?go_percom
   804 004E 4C 72 01		     jmp READSTATUS
   805 0051			?go_percom
   806 0051 4C 78 01		     jmp READPERCOM
   807
   808 				;
   809 				; check for read sector or write sector
   810 				;
   811 0054			?callcmd
   812 0054 E0 03		     cpx #$03
   813 0056 B0 F2		     bcs ?jother
   814 				;
   815 				; we know that we have a read or write
   816 				;
   817 0058 AD 95 01		     lda spt_lo
   818 005B CD 0A 03		     cmp DAUX1
   819 005E AD 94 01		     lda spt_hi
   820 0061 ED 0B 03		     sbc DAUX2
   821 0064 90 DE		     bcc ?rwerr
   822 				;
   823 				; compute buffer address in cartridge RAM
   824 				;
   825 0066 AD 0A 03		     lda DAUX1               ; get low byte of sector
   826 0069 38			     sec                     ; set Bit7
   827 006A 6A			     ror                     ; save Bit0 in carry
   828 006B 29 BF		     and #$bf                ; clear Bit6
   829 006D 8D 3E 01		     sta _wtofast+2
   830 0070 8D 4F 01		     sta _rfromfast+2
   831 0073 A9 00		     lda #$00
   832 0075 6A			     ror                     ; make carry Bit7
   833 0076 8D 3D 01		     sta _wtofast+1
   834 0079 8D 4E 01		     sta _rfromfast+1
   835 				;
   836 				; compute bank number in RAM.
   837 				; we have 128 sectors in a 16KB bank so we need
   838 				; to shift right DAUX1/2 by 6 (or left by 2)
   839 				;
   840 007C AD 0A 03		     lda DAUX1               ; get low byte of sector
   841 007F 0A			     asl                     ; save Bit8 in carry 
   842 0080 AD 0B 03		     lda DAUX2               ; get high byte of sector
   843 0083 2A			     rol                     ; get Bit8 of low byte 
   844 0084 0A			     asl                     ; get bank number with LSB 0
   845 0085 A8			     tay
   846 				;
   847 				; save THE!CART registers and disable interrupts
   848 				;
   849 0086 20 9B 00		     jsr save_cart_regs
   850 0089 20 BA 00		     jsr set_cart_regs
   851 				;
   852 				; call read or write routine
   853 				;
   854 008C A2 00		     ldx #0
   855 008E 2C 03 03		     bit DSTATS
   856 0091 10 04		     bpl ?jread
   857
   858 0093 20 20 01		     jsr WRITESECTOR
   859 0096 60			     rts
   860 				     
   861 0097			?jread
   862 0097 20 48 01		     jsr READSECTOR
   863 009A 60			     rts
   864 				;
   865 				; save THE!CART registers into hide_cart_ram code
   866 				;
   867 009B			save_cart_regs
   868
   869 009B AD A6 D5		     lda TCMOSL
   870 009E 8D FD 00		     sta _hpatchTCMOSL+1
   871 00A1 AD A7 D5		     lda TCMOFR
   872 00A4 8D 0C 01		     sta _hpatchTCMOFR+1
   873 00A7 AD A0 D5		     lda TCPBRL
   874 00AA 8D 07 01		     sta _hpatchTCPBRL+1
   875 00AD AD A1 D5		     lda TCPBRH
   876 00B0 8D 02 01		     sta _hpatchTCPBRH+1
   877 00B3 AD A2 D5		     lda TCPBEN
   878 00B6 8D 11 01		     sta _hpatchTCPBEN+1
   879
   880 00B9 60			     rts
   881 				;
   882 				; save THE!CART registers into show_cart_ram code
   883 				;
   884 00BA			set_cart_regs
   885
   886 00BA A9 21		     lda #TCMOSL.16K
   887 00BC 8D E3 00		     sta _spatchTCMOSL+1
   888 00BF A9 03		     lda #TCMOFR.PBRAM
   889 00C1 8D E8 00		     sta _spatchTCMOFR+1
   890 00C4 8C ED 00		     sty _spatchTCPBRL+1
   891 00C7 A9 00		     lda #$00
   892 00C9 8D F2 00		     sta _spatchTCPBRH+1
   893 00CC A9 01		     lda #$01
   894 00CE 8D F7 00		     sta _spatchTCPBEN+1
   895
   896 00D1 60			     rts
   897 				;
   898 				; enable THE!CART ram
   899 				;
   900 00D2			show_cart_ram
   901 				     
   902 00D2 A9 FF		     lda #$FF
   903 00D4 85 42		     sta CRITIC 
   904 00D6 A5 14		     lda RTCLOK+2
   905 00D8			_wait2
   906 00D8 C5 14		     cmp RTCLOK+2
   907 00DA F0 FC		     beq _wait2
   908
   909 00DC 78			     sei
   910 00DD A9 00		     lda #0
   911 00DF 8D 0E D4		     sta NMIEN
   912
   913 00E2			_spatchTCMOSL
   914 00E2 A0 00		     ldy #0
   915 00E4 8C A6 D5		     sty TCMOSL
   916 00E7			_spatchTCMOFR
   917 00E7 A0 00		     ldy #0
   918 00E9 8C A7 D5		     sty TCMOFR
   919 00EC			_spatchTCPBRL
   920 00EC A0 00		     ldy #0
   921 00EE 8C A0 D5		     sty TCPBRL
   922 00F1			_spatchTCPBRH
   923 00F1 A0 00		     ldy #0
   924 00F3 8C A1 D5		     sty TCPBRH
   925 00F6			_spatchTCPBEN
   926 00F6 A0 00		     ldy #0
   927 00F8 8C A2 D5		     sty TCPBEN
   928
   929 00FB 60			     rts
   930 				;
   931 				; remove THE!CART ram
   932 				;
   933 00FC			hide_cart_ram
   934
   935 00FC			_hpatchTCMOSL
   936 00FC A0 00		     ldy #0
   937 00FE 8C A6 D5		     sty TCMOSL
   938 0101			_hpatchTCPBRH
   939 0101 A0 00		     ldy #0
   940 0103 8C A1 D5		     sty TCPBRH
   941 0106			_hpatchTCPBRL
   942 0106 A0 00		     ldy #0
   943 0108 8C A0 D5		     sty TCPBRL
   944 010B			_hpatchTCMOFR
   945 010B A0 00		     ldy #0
   946 010D 8C A7 D5		     sty TCMOFR
   947 0110			_hpatchTCPBEN
   948 0110 A0 00		     ldy #0
   949 0112 8C A2 D5		     sty TCPBEN
   950
   951 0115 A9 E0		     lda #$E0
   952 0117 8D 0E D4		     sta NMIEN
   953 011A 58			     cli
   954
   955 011B A9 00		     lda #$00
   956 011D 85 42		     sta CRITIC 
   957
   958 011F 60			     rts
   959 				;
   960 				; Write sector command
   961 				;
   962 0120			WRITESECTOR
   963
   964 0120 AD 87 07		     lda SYSCALL
   965 0123 20 F1 07		     jsr jext_on
   966 0126 A2 7F		     ldx #$7f
   967 0128			_wfromfast
   968 0128 BD FF FF		     lda $FFFF,x
   969 012B 9D A8 01		     sta ramdisk_buffer,x
   970 012E CA			     dex
   971 012F 10 F7		     bpl _wfromfast
   972 0131 20 F4 07		     jsr jext_off
   973
   974 0134 20 D2 00		     jsr show_cart_ram
   975 0137 A2 7F		     ldx #$7f
   976 0139			_wfromfast_buf
   977 0139 BD A8 01		     lda ramdisk_buffer,x
   978 013C			_wtofast
   979 013C 9D FF FF		     sta $FFFF,x
   980 013F CA			     dex
   981 0140 10 F7		     bpl _wfromfast_buf
   982 0142 20 FC 00		     jsr hide_cart_ram
   983 				     
   984 0145 4C 6D 01		     jmp ?operation_ok
   985 				     
   986 				;
   987 				; Read sector command
   988 				;
   989 0148			READSECTOR
   990 				     
   991 0148 20 D2 00		     jsr show_cart_ram
   992 014B A2 7F		     ldx #$7f
   993 014D			_rfromfast
   994 014D BD FF FF		     lda $FFFF,x
   995 0150 9D A8 01		     sta ramdisk_buffer,x
   996 0153 CA			     dex
   997 0154 10 F7		     bpl _rfromfast     
   998 0156 20 FC 00		     jsr hide_cart_ram
   999
  1000 0159 AD 87 07		     lda SYSCALL
  1001 015C 20 F1 07		     jsr jext_on
  1002 015F A2 7F		     ldx #$7f
  1003 0161			_rfromfast_buf
  1004 0161 BD A8 01		     lda ramdisk_buffer,x
  1005 0164			_rtofast
  1006 0164 9D FF FF		     sta $FFFF,x
  1007 0167 CA			     dex
  1008 0168 10 F7		     bpl _rfromfast_buf
  1009 016A 20 F4 07		     jsr jext_off
  1010
  1011 016D			?operation_ok
  1012 016D A9 01		     lda #$01
  1013 016F A8			     tay
  1014 0170 18			     clc
  1015 0171 60			     rts
  1016 				;
  1017 				; Read Status and Read Percom commands
  1018 				;
  1019 0172			READSTATUS
  1020 0172 A2 0F		     ldx #$0f
  1021 0174 A0 03		     ldy #$03
  1022 0176 D0 04		     bne ?rdperc
  1023 0178			READPERCOM
  1024 0178 A2 0B		     ldx #$0b
  1025 017A A0 0B		     ldy #$0b
  1026 017C			?rdperc
  1027 017C AD 87 07		     lda SYSCALL
  1028 017F 20 F1 07		     jsr jext_on
  1029 0182			?nxtpb
  1030 0182 BD 92 01		     lda tpercom,x
  1031 0185 91 34		     sta (BUFEN),y
  1032 0187 CA			     dex
  1033 0188 88			     dey
  1034 0189 10 F7		     bpl ?nxtpb
  1035 018B 20 F4 07		     jsr jext_off
  1036 018E 4C 6D 01		     jmp ?operation_ok
  1037 				;
  1038 				; ramdisk drive number
  1039 				;
  1040 0191			ramdisk_drive
  1041 0191 0F			     .byte 15
  1042 				;
  1043 				; Read percom answer
  1044 				;
  1045 0192			tpercom
  1046 0192 01			     .byte 1    ;no of tracks
  1047 0193 01			     .byte 1    ;step rate
  1048 0194			spt_hi
  1049 0194 00			     .byte 0    ;sector per track hi - $0E for 470KB
  1050 0195			spt_lo
  1051 0195 00			     .byte 0    ;sector per track lo - $B0 for 470KB
  1052 0196 00			     .byte 0    ;no of sides - 1
  1053 0197 04			     .byte 4    ;record method (4=MFM)
  1054 0198 00			     .byte 0    ;bytes per sector hi
  1055 0199 80			     .byte $80  ;bytes per sector lo (128 bytes)
  1056 019A FF			     .byte $FF  ;drive online
  1057 019B 00			     .byte 0    ;unused
  1058 019C 00			     .byte 0    ;unused
  1059 019D 00			     .byte 0    ;unused
  1060 				;
  1061 				; Read status answer
  1062 				;
  1063 019E			tstatus
  1064 019E 10			     .byte $10
  1065 019F FF			     .byte $FF
  1066 01A0 E0			     .byte $E0
  1067 				;
  1068 				; Number of sectors of this ramdisk (128 bytes)
  1069 				; and sector buffer
  1070 				;
  1071 01A1			ramdisk_sectors
  1072 01A1 00 00		     .word 0
  1073 01A3			sio_cmds
  1074 01A3 52 57 50 53 4E	     .byte 'RWPSN'
  1075 01A8			ramdisk_buffer
  1076 01A8 00 00 00 00 00 00 + :128 .byte 0
  1077
  1078 				     end
  1078 0228 FD FF 01 00 00	BLK UPDATE ADDRESS
  1078 0228 FD 12 30		
  1078 0228 FD 26 30		
  1078 0228 FD 2B 30		
  1078 0228 FD 6E 30		
  1078 0228 FD 73 30		
  1078 0228 FD 78 30		
  1078 0228 FD 7D 30		
  1078 0228 FD 80 30		
  1078 0228 FD 84 30		
  1078 0228 FD 88 30		
  1078 0228 FD 8C 30		
  1078 0228 FD 8F 30		
  1078 0228 FD AC 30		
  1078 0228 FD BA 30		
  1078 0228 FD BD 30		
  1078 0228 FD C0 30		
  1078 0228 FD C3 30		
  1078 0228 FD 6A 31		
  1078 0228 FD 9C 31		
  1078 0228 FE 01 02 21 0C 03 + 
  1078 0228 FC			
  1078 0228			BLK UPDATE SYMBOL
  1078 0228 FB FF 42 55 49 4C + BUILDDIR
  1078 0228 FD 74 31		
  1078 0228 FC			
  1078 0228 FB FF 43 4F 4D 54 + COMTAB  
  1078 0228 FD 35 30		
  1078 0228 FD 5B 30		
  1078 0228 FD 65 30		
  1078 0228 FC			
  1078 0228 FB FF 43 4F 4D 54 + COMTAB2 
  1078 0228 FE 01 20		
  1078 0228 FC			
  1078 0228 FB FF 44 45 56 53 + DEVSPEC 
  1078 0228 FD 0F 30		
  1078 0228 FC			
  1078 0228 FB FF 47 45 54 45 + GETENV  
  1078 0228 FD 19 30		
  1078 0228 FC			
  1078 0228 FB FF 49 4E 53 54 + INSTALL 
  1078 0228 FD 98 31		
  1078 0228 FC			
  1078 0228 FB FF 50 52 49 4E + PRINTF  
  1078 0228 FD 3C 31		
  1078 0228 FD 77 31		
  1078 0228 FD B9 31		
  1078 0228 FD EC 31		
  1078 0228 FC			
  1078 0228 FB FF 55 5F 47 45 + U_GETPAR
  1078 0228 FD 2E 30		
  1078 0228 FC			
